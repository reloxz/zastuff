local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local COMMAND_URL = "https://69f4e7819a3f.ngrok-free.app/latest-command"

local bannedUsers = {}

local function runCommand(cmd)
	if not cmd or not cmd.text then return end
	local sender = cmd.sender or "Discord"
	local text = cmd.text
	local lowerText = text:lower()

	print("[COMMAND RECEIVED] From:", sender, "| Command:", text)

	if lowerText:sub(1, 4) == "say " then
		local msg = text:sub(5)
		print(`[Vecxo Remote API] {sender}: {msg}`)

	elseif lowerText:sub(1, 9) == "!message " then
		local msgText = text:sub(10)
		local messageInstance = Instance.new("Message")
		messageInstance.Text = `[${sender}] ${msgText}`
		messageInstance.Parent = workspace
		task.delay(5, function()
			if messageInstance then messageInstance:Destroy() end
		end)

	elseif lowerText:sub(1, 6) == "!kick " then
		local targetName = text:sub(7)
		for _, plr in pairs(Players:GetPlayers()) do
			if plr.Name:lower() == targetName:lower() then
				plr:Kick("You were kicked by Discord user: " .. sender)
				print(`[Vecxo Remote API] {sender} kicked {plr.Name}`)
				break
			end
		end

	elseif lowerText:sub(1, 5) == "!ban " then
		local targetName = text:sub(6)
		bannedUsers[targetName:lower()] = true
		for _, plr in pairs(Players:GetPlayers()) do
			if plr.Name:lower() == targetName:lower() then
				plr:Kick("You were banned by Discord user: " .. sender)
				print(`[Vecxo Remote API] {sender} banned {plr.Name}`)
				break
			end
		end

	elseif lowerText == "!shutdown" then
		print(`[Vecxo Remote API] {sender} shut down the server.`)
		for _, plr in pairs(Players:GetPlayers()) do
			plr:Kick("Server is shutting down by Discord user: " .. sender)
		end
		game:Shutdown()
	end
end
